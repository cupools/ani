{"version":3,"file":"velocity-component.js","sources":["../src/velocity-component.js"],"sourcesContent":["import { h, Component } from 'preact'\nimport Velocity from 'velocity-animate'\nimport { isEqual } from 'lodash'\n\nclass VelocityComponent extends Component {\n  componentDidMount() {\n    this.runAnimation()\n\n    if (!this.props.runOnMount) {\n      // should work with default props\n      // this._finishAnimation()\n    }\n  }\n\n  componentWillUnmount() {\n    this._stopAnimation()\n    this._clearVelocityCache(this._getDOMTarget())\n  }\n\n  componentWillUpdate(newProps) {\n    if (!isEqual(newProps.keyframes, this.props.keyframes)) {\n      this._stopAnimation()\n      this._scheduleAnimation()\n    }\n  }\n\n  runAnimation(config = {}) {\n    if (!this.props.keyframes) {\n      return\n    }\n\n    const dom = this._getDOMTarget()\n    this._shouldRunAnimation = false\n\n    if (config.stop) {\n      Velocity(dom, 'stop', true)\n    } else if (config.finish) {\n      Velocity(dom, 'finishAll', true)\n    }\n\n    const { keyframes, ...ani } = this.props\n\n    // FIXME, origin status\n    Velocity(this._getDOMTarget(), ani, { duration: 0 })\n\n    keyframes.forEach(keyframe => {\n      const { duration = 0, delay = 0, easing = 'linear', loop = 0, ...props } = keyframe\n\n      Velocity(this._getDOMTarget(), props, {\n        duration,\n        delay,\n        easing,\n        loop\n      })\n    })\n  }\n\n  _scheduleAnimation() {\n    if (this._shouldRunAnimation) {\n      return\n    }\n\n    this._shouldRunAnimation = true\n    setTimeout(this.runAnimation.bind(this), 0)\n  }\n\n  _getDOMTarget() {\n    return this.base\n  }\n\n  _finishAnimation() {\n    Velocity(this._getDOMTarget(), 'finishAll', true)\n  }\n\n  _stopAnimation() {\n    Velocity(this._getDOMTarget(), 'stop', true)\n  }\n\n  _clearVelocityCache(target) {\n    if (target.length) {\n      target.forEach(this._clearVelocityCache)\n    } else {\n      Velocity.Utilities.removeData(target, ['velocity', 'fxqueue'])\n    }\n  }\n\n  render() {\n    return this.props.children.length ? this.props.children[0] : <span {...this.props}></span>\n  }\n\n  getDefaultProps() {\n    // maybe should work with preact-compat\n    return {\n      animation: null,\n      runOnMount: false\n    }\n  }\n}\n\nexport default VelocityComponent\n"],"names":["VelocityComponent","componentDidMount","runAnimation","this","props","runOnMount","componentWillUnmount","_stopAnimation","_clearVelocityCache","_getDOMTarget","componentWillUpdate","newProps","isEqual","keyframes","_scheduleAnimation","config","dom","_shouldRunAnimation","stop","finish","ani","duration","forEach","keyframe","delay","easing","loop","_this2","bind","base","_finishAnimation","target","length","Utilities","removeData","render","children","h","getDefaultProps","Component"],"mappings":"6hCAIMA,sGACJC,kCACOC,gBAEAC,KAAKC,MAAMC,wBAMlBC,qCACOC,sBACAC,oBAAoBL,KAAKM,8BAGhCC,6BAAoBC,GACbC,UAAQD,EAASE,UAAWV,KAAKC,MAAMS,kBACrCN,sBACAO,mCAITZ,mCAAaa,+DACNZ,KAAKC,MAAMS,cAIVG,GAAMb,KAAKM,qBACZQ,qBAAsB,EAEvBF,EAAOG,OACAF,EAAK,QAAQ,GACbD,EAAOI,UACPH,EAAK,aAAa,SAGCb,KAAKC,MAA3BS,IAAAA,UAAcO,uBAGbjB,KAAKM,gBAAiBW,GAAOC,SAAU,MAEtCC,QAAQ,kBAC2DC,EAAnEF,SAAAA,aAAW,MAAwDE,EAArDC,MAAAA,aAAQ,MAA6CD,EAA1CE,OAAAA,aAAS,aAAiCF,EAAvBG,KAAAA,aAAO,IAAMtB,IAAUmB,0CAElEI,EAAKlB,gBAAiBL,wDASnCU,8BACMX,KAAKc,2BAIJA,qBAAsB,aAChBd,KAAKD,aAAa0B,KAAKzB,MAAO,iBAG3CM,+BACSN,MAAK0B,kBAGdC,8BACW3B,KAAKM,gBAAiB,aAAa,gBAG9CF,4BACWJ,KAAKM,gBAAiB,QAAQ,gBAGzCD,6BAAoBuB,GACdA,EAAOC,SACFV,QAAQnB,KAAKK,uBAEXyB,UAAUC,WAAWH,GAAS,WAAY,yBAIvDI,wBACShC,MAAKC,MAAMgC,SAASJ,OAAS7B,KAAKC,MAAMgC,SAAS,GAAKC,WAAUlC,KAAKC,oBAG9EkC,4CAGe,iBACC,OA1FcC"}